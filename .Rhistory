time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)
names(df)
#lets clean and mutate the variables
df <- df %>%
select(ResponseID:EndDate, Finished, age:audit, a_control, a_treatment,
b_control, b_placebo, b_treatment, c_control, c_treatment, d_control,
d_treatment, e_control, e_placebo, e_treatment, fmc_a, fmc_b, fmc_e,
placebo_1_direct:sponsor,
lat = LocationLatitude, long = LocationLongitude, LocationAccuracy) %>%
mutate(imc_1 = ifelse(is.na(IMC_1_1) & is.na(IMC_1_2) & is.na(IMC_1_4) & is.na(IMC_1_5) & is.na(IMC_1_6),
"pass", "fail"),
imc_2_1 = ifelse(imc_2_1 == "说不上同意或反对", "pass", "fail"),
imc_2_2 = ifelse(imc_2_2 == "强烈同意", "pass", "fail"),
attentive_imc = ifelse(imc_1 == "pass" & imc_2_1 == "pass" & imc_2_2 == "pass",
"attentive", "inattentive"),
audit = ifelse(is.na(audit), "control", "received"),
fmc_a = ifelse(fmc_a == "在我们国家，空气污染是一个重要的问题。", "pass", "fail"),
fmc_b = ifelse(fmc_b == "政府就像是家长，应该告诉人民应该做什么。", "pass", "fail"),
fmc_e = ifelse(fmc_e == "政府为所有人提供优质的公共服务。", "pass", "fail"),
c_direct_dk = ifelse(c_direct == "不想回答", 1, 0), #for priming checks
d_direct_dk = ifelse(d_direct == "不想回答", 1, 0), #and filter drop DK
e_direct_dk = ifelse(e_direct == "不想回答", 1, 0), #in main analysis
c_direct = ifelse(c_direct == "同意", 1, 0),
d_direct = ifelse(d_direct == "同意", 1, 0),
e_direct = ifelse(e_direct == "同意", 1, 0),
placebo_direct = ifelse(placebo_1_direct == "同意" | placebo_2_direct == "同意", 1, 0),
time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)
names(df)
#we want data from the 5th one in the list
df <- fetch_survey(surveys$id[4], convert = FALSE)
#lets clean and mutate the variables
df <- df %>%
select(ResponseID:EndDate, Finished, age:audit, a_control, a_treatment,
b_control, b_placebo, b_treatment, c_control, c_treatment, d_control,
d_treatment, e_control, e_placebo, e_treatment, fmc_a, fmc_b, fmc_e,
placebo_1_direct:sponsor,
lat = LocationLatitude, long = LocationLongitude, LocationAccuracy) %>%
mutate(imc_1 = ifelse(is.na(IMC_1_1) & is.na(IMC_1_2) & is.na(IMC_1_4) & is.na(IMC_1_5) & is.na(IMC_1_6),
"pass", "fail"),
imc_2_1 = ifelse(imc_2_1 == "说不上同意或反对", "pass", "fail"),
imc_2_2 = ifelse(imc_2_2 == "强烈同意", "pass", "fail"),
attentive_imc = ifelse(imc_1 == "pass" & imc_2_1 == "pass" & imc_2_2 == "pass",
"attentive", "inattentive"),
audit = ifelse(is.na(audit), "control", "received"),
fmc_a = ifelse(fmc_a == "在我们国家，空气污染是一个重要的问题。", "pass", "fail"),
fmc_b = ifelse(fmc_b == "政府就像是家长，应该告诉人民应该做什么。", "pass", "fail"),
fmc_e = ifelse(fmc_e == "政府为所有人提供优质的公共服务。", "pass", "fail"),
c_direct_dk = ifelse(c_direct == "不想回答", 1, 0), #for priming checks
d_direct_dk = ifelse(d_direct == "不想回答", 1, 0), #and filter drop DK
e_direct_dk = ifelse(e_direct == "不想回答", 1, 0), #in main analysis
c_direct = ifelse(c_direct == "同意", 1, 0),
d_direct = ifelse(d_direct == "同意", 1, 0),
e_direct = ifelse(e_direct == "同意", 1, 0),
placebo_direct = ifelse(placebo_1_direct == "同意" | placebo_2_direct == "同意", 1, 0),
time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)
names(df)
df_test <- df %>% select(-c(IMC_1_1:IMC_1_6, info, imc_2_3:imc_2_7,
placebo_1_direct:placebo_2_direct, StartDate, EndDate))
#lets remove"项" from the treatment, control and placebo groups
keep_digit <- function(x) gsub("[^0-9]", "", x)
vars <- c("a_control", "a_treatment", "b_control", "b_placebo", "b_treatment",
"c_control", "c_treatment", "d_control","d_treatment",
"e_control", "e_placebo", "e_treatment")
df <-  df %>% mutate_at(vars, keep_digit)
View(df)
View(df)
df <- df %>% select(-c(IMC_1_1:IMC_1_6, info, imc_2_3:imc_2_7,
placebo_1_direct:placebo_2_direct, StartDate, EndDate))
View(df)
surveys
#we want data from the 5th one in the list
df <- fetch_survey(surveys$id[5], convert = FALSE)
names(df)
View(df)
#lets clean and mutate the variables
df <- df %>%
select(ResponseID:EndDate, Finished, age:audit, a_control, a_treatment,
b_control, b_placebo, b_treatment, c_control, c_treatment, d_control,
d_treatment, e_control, e_placebo, e_treatment, fmc_a, fmc_b, fmc_e,
placebo_1_direct:sponsor,
lat = LocationLatitude, long = LocationLongitude, LocationAccuracy) %>%
mutate(imc_1 = ifelse(is.na(IMC_1_1) & is.na(IMC_1_2) & is.na(IMC_1_4) & is.na(IMC_1_5) & is.na(IMC_1_6),
"pass", "fail"),
imc_2_1 = ifelse(imc_2_1 == "说不上同意或反对", "pass", "fail"),
imc_2_2 = ifelse(imc_2_2 == "强烈同意", "pass", "fail"),
attentive_imc = ifelse(imc_1 == "pass" & imc_2_1 == "pass" & imc_2_2 == "pass",
"attentive", "inattentive"),
audit = ifelse(is.na(audit), "control", "received"),
fmc_a = ifelse(fmc_a == "在我们国家，空气污染是一个重要的问题。", "pass", "fail"),
fmc_b = ifelse(fmc_b == "政府就像是家长，应该告诉人民应该做什么。", "pass", "fail"),
fmc_e = ifelse(fmc_e == "政府为所有人提供优质的公共服务。", "pass", "fail"),
c_direct_dk = ifelse(c_direct == "不想回答", 1, 0), #for priming checks
d_direct_dk = ifelse(d_direct == "不想回答", 1, 0), #and filter drop DK
e_direct_dk = ifelse(e_direct == "不想回答", 1, 0), #in main analysis
c_direct = ifelse(c_direct == "同意", 1, 0),
d_direct = ifelse(d_direct == "同意", 1, 0),
e_direct = ifelse(e_direct == "同意", 1, 0),
placebo_direct = ifelse(placebo_1_direct == "同意" | placebo_2_direct == "同意", 1, 0),
time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)
df <- df %>% select(-c(IMC_1_1:IMC_1_6, info, imc_2_3:imc_2_7,
placebo_1_direct:placebo_2_direct, StartDate, EndDate))
#lets remove"项" from the treatment, control and placebo groups
keep_digit <- function(x) gsub("[^0-9]", "", x)
vars <- c("a_control", "a_treatment", "b_control", "b_placebo", "b_treatment",
"c_control", "c_treatment", "d_control","d_treatment",
"e_control", "e_placebo", "e_treatment")
df <-  df %>% mutate_at(vars, keep_digit)
View(df)
library(qualtRics)
library(tidyverse)
library(lubridate)
#browse all surveys
surveys <- all_surveys()
surveys
#we want data from the 5th one in the list
#i've generated test data
df <- fetch_survey(surveys$id[5], convert = FALSE)
names(df)
#lets clean and mutate the variables
df <- df %>%
select(ResponseID:EndDate, Finished, age:audit, a_control, a_treatment,
b_control, b_placebo, b_treatment, c_control, c_treatment, d_control,
d_treatment, e_control, e_placebo, e_treatment, fmc_a, fmc_b, fmc_e,
placebo_1_direct:sponsor,
lat = LocationLatitude, long = LocationLongitude, LocationAccuracy) %>%
mutate(imc_1 = ifelse(is.na(IMC_1_1) & is.na(IMC_1_2) & is.na(IMC_1_4) & is.na(IMC_1_5) & is.na(IMC_1_6),
"pass", "fail"),
imc_2_1 = ifelse(imc_2_1 == "说不上同意或反对", "pass", "fail"),
imc_2_2 = ifelse(imc_2_2 == "强烈同意", "pass", "fail"),
attentive_imc = ifelse(imc_1 == "pass" & imc_2_1 == "pass" & imc_2_2 == "pass",
"attentive", "inattentive"),
audit = ifelse(is.na(audit), "control", "received"),
fmc_a = ifelse(fmc_a == "在我们国家，空气污染是一个重要的问题。", "pass", "fail"),
fmc_b = ifelse(fmc_b == "政府就像是家长，应该告诉人民应该做什么。", "pass", "fail"),
fmc_e = ifelse(fmc_e == "政府为所有人提供优质的公共服务。", "pass", "fail"),
c_direct_dk = ifelse(c_direct == "不想回答", 1, 0), #for priming checks
d_direct_dk = ifelse(d_direct == "不想回答", 1, 0), #and filter drop DK
e_direct_dk = ifelse(e_direct == "不想回答", 1, 0), #in main analysis
c_direct = ifelse(c_direct == "同意", 1, 0),
d_direct = ifelse(d_direct == "同意", 1, 0),
e_direct = ifelse(e_direct == "同意", 1, 0),
placebo_direct = ifelse(placebo_1_direct == "同意" | placebo_2_direct == "同意", 1, 0),
time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)
df <- df %>% select(-c(IMC_1_1:IMC_1_6, info, imc_2_3:imc_2_7,
placebo_1_direct:placebo_2_direct, StartDate, EndDate))
#lets remove"项" from the treatment, control and placebo groups
keep_digit <- function(x) gsub("[^0-9]", "", x)
vars <- c("a_control", "a_treatment", "b_control", "b_placebo", "b_treatment",
"c_control", "c_treatment", "d_control","d_treatment",
"e_control", "e_placebo", "e_treatment")
df <-  df %>% mutate_at(vars, keep_digit)
write_csv(df, "data/survey-data.csv")
View(df)
names(df)
table(df$attentive_imc)
#we want data from the 5th one in the list (for now it generated test data)
df <- fetch_survey(surveys$id[5], convert = FALSE)
#we want data from the 5th one in the list (for now it generated test data)
df <- fetch_survey(surveys$id[5], convert = FALSE, force_request = TRUE)
names(df)
#lets clean and mutate the variables
df <- df %>%
select(ResponseID:EndDate, Finished, age:audit, a_control, a_treatment,
b_control, b_placebo, b_treatment, c_control, c_treatment, d_control,
d_treatment, e_control, e_placebo, e_treatment, fmc_a, fmc_b, fmc_e,
placebo_1_direct:sponsor,
lat = LocationLatitude, long = LocationLongitude, LocationAccuracy) %>%
mutate(imc_1 = ifelse(is.na(IMC_1_1) & is.na(IMC_1_2) & is.na(IMC_1_4) & is.na(IMC_1_5) & is.na(IMC_1_6),
"pass", "fail"),
imc_2_1 = ifelse(imc_2_1 == "说不上同意或反对", "pass", "fail"),
imc_2_2 = ifelse(imc_2_2 == "强烈同意", "pass", "fail"),
attentive_imc = ifelse(imc_1 == "pass" & imc_2_1 == "pass" & imc_2_2 == "pass",
"attentive", "inattentive"),
audit = ifelse(is.na(audit), "control", "received"),
fmc_a = ifelse(fmc_a == "在我们国家，空气污染是一个重要的问题。", "pass", "fail"),
fmc_b = ifelse(fmc_b == "政府就像是家长，应该告诉人民应该做什么。", "pass", "fail"),
fmc_e = ifelse(fmc_e == "政府为所有人提供优质的公共服务。", "pass", "fail"),
c_direct_dk = ifelse(c_direct == "不想回答", 1, 0), #for priming checks
d_direct_dk = ifelse(d_direct == "不想回答", 1, 0), #and filter drop DK
e_direct_dk = ifelse(e_direct == "不想回答", 1, 0), #in main analysis
c_direct = ifelse(c_direct == "同意", 1, 0),
d_direct = ifelse(d_direct == "同意", 1, 0),
e_direct = ifelse(e_direct == "同意", 1, 0),
placebo_direct = ifelse(placebo_1_direct == "同意" | placebo_2_direct == "同意", 1, 0),
time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)
df <- df %>% select(-c(IMC_1_1:IMC_1_6, info, imc_2_3:imc_2_7,
placebo_1_direct:placebo_2_direct, StartDate, EndDate))
write_csv(df, "data/survey-data.csv")
#lets remove"项" from the treatment, control and placebo groups
keep_digit <- function(x) gsub("[^0-9]", "", x)
vars <- c("a_control", "a_treatment", "b_control", "b_placebo", "b_treatment",
"c_control", "c_treatment", "d_control","d_treatment",
"e_control", "e_placebo", "e_treatment")
df <-  df %>% mutate_at(vars, keep_digit)
write_csv(df, "data/survey-data.csv")
df
library(tidyverse)
#all of them?
df %>% group_by(attentive_imc) %>% summarise(N=n())
#pass imc_1
df %>% group_by(imc_1) %>% summarise(N=n())
#pass imc_2_1 (chose middle option)
df %>% group_by(imc_2_1) %>% summarise(N=n())
mean(df$time_spent)
df$time_spent <- rnorm(56, 240)
mean(df$time_spent)
df %>%
ggplot(aes(x=time_spent)) +
geom_density()
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
df$attentive_imc <- rep(c("attentive", "inattentive"), 28)
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
df %>%
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density(alpha = .5)
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc, aplha = .5)) +
geom_density()
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc), aplha = .5) +
geom_density()
df <- df %>% mutate(time_spent = ifelse(attentive_imc == "attentive", time_spent + rnorm(80), time_spent))
df <- df %>% mutate(time_spent = ifelse(attentive_imc == "attentive", time_spent + rnorm(1,80), time_spent))
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
df <- df %>% mutate(time_spent = ifelse(attentive_imc == "attentive", time_spent + rnorm(1,80,sd=100), time_spent))
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
df <- rio::import("data/survey-data.csv")
df$attentive_imc <- rep(c("attentive", "inattentive"), 28)
df <- df %>% mutate(time_spent = ifelse(attentive_imc == "attentive", time_spent + rnorm(1,80,sd=100), time_spent))
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
unique(df$IPAddress)
unique(df$IPAddress, na.rm=TRUE)
View(df)
View(df_test)
duplicated(df_test$IPAddress, na.rm=TRUE)
```{r}
#
install.packages("mapview")
library()
df %>%
df_test %>%
st_as_sf(coords = c("lng", "lat")) %>%
mapview()
map <- df_test %>%
st_as_sf(coords = c("lng", "lat"))
#create sf object
map <- df_test %>%
st_as_sf(coords = c("lng", "lat"))
library(sf)
#view
df_test %>%
st_as_sf(coords = c("lng", "lat")) %>%
mapview()
#view
df_test %>%
st_as_sf(coords = c("lng", "lat")) %>%
mapview::mapview()
names(df_test$long) <- lng
names(df_test$long) <- "lng"
df_test <- df_test %>% mutate(lng = long)
#view
df_test %>%
st_as_sf(coords = c("lng", "lat")) %>%
mapview::mapview()
#view
df_test %>%
st_as_sf(coords = c("lng", "lat")) %>%
st_crs(4326) %>%
mapview::mapview()
#create sf object
map <- df_test %>%
st_as_sf(coords = c("lng", "lat"))
#set projection
st_crs(map) <- st_crs(4326)
#set projection
st_crs(map) <- st_crs(4326) %>%
mapview::mapview()
#set projection
st_crs(map) <- st_crs(4326) %>%
mapview::mapview(map)
#create sf object
map <- df_test %>%
st_as_sf(coords = c("lng", "lat"))
View(map)
#set projection
st_crs(map) <- st_crs(4326)
mapview::mapview(map)
library(tidyverse)
```{r}
df %>% hist(a_control)
```
df <- rio::import("data/survey-data.csv")
```{r}
df %>% hist(a_control)
```
table(a_control)
table(df$a_control)
```{r}
hist(df$a_control)
```
df %>% select(a_control:e_treatment) %>%
gather()
df %>% select(a_control:e_treatment) %>%
gather() %>%
ggplot(aes(x=value)) +
geom_histogram() +
facet_wrap(~key)
View(df)
names(df)
```{r}
df %>% group_by(placebo_direct) %>% summarise(N=n())
```
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(., mean(na.rm=TRUE))
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(., .mean(na.rm=TRUE))
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(., .mean(.,na.rm=TRUE))
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(list(mean(.,na.rm=TRUE)))
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(list(mean(na.rm=TRUE)))
test <- df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct)
test %>% summarise_all(list(mean(na.rm=TRUE)))
?summarise_all()
test %>% summarise_all(mean(na.rm=TRUE))
library(tidyverse)
test %>% summarise_all(mean, na.rm=TRUE)
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(mean, na.rm=TRUE) %>%
mutate(a_dim = a_treatment - a_control,
b_dim = b_treatment - b_control,
b_dim_placebo = b_treatment - b_placebo,
c_dim = c_treatment - c_control,
d_dim = d_treatment - d_control,
e_dim = e_treatment - c_control,
e_dim = e_treatment - c_control,
e_dim_placebo = e_treatment - e_placebo,
c_est = c_direct - c_dim,
d_est = d_direct - d_cim,
e_est = e_direct - e_dim,
e_est_placebo = e_direct - e_dim_placebo) %>%
select(a_dim:e_est_placebo)
df %>% select(a_control:e_treatment, c_direct, d_direct, e_direct) %>%
summarise_all(mean, na.rm=TRUE) %>%
mutate(a_dim = a_treatment - a_control,
b_dim = b_treatment - b_control,
b_dim_placebo = b_treatment - b_placebo,
c_dim = c_treatment - c_control,
d_dim = d_treatment - d_control,
e_dim = e_treatment - c_control,
e_dim = e_treatment - c_control,
e_dim_placebo = e_treatment - e_placebo,
c_est = c_direct - c_dim,
d_est = d_direct - d_dim,
e_est = e_direct - e_dim,
e_est_placebo = e_direct - e_dim_placebo) %>%
select(a_dim:e_est_placebo)
?var
mean(df$a_treatment, na.rm=T)-mean(df$a_control, na.rm=T)
mean(df$a_treatment -df$a_control, na.rm=T)
prmse <- function(estimand, treatment, control) {
sqrt(
(var(treatment, na.rm=TRUE) + var(control, na.rm=TRUE))
+ (estimand - ((mean(treatment, na.rm=TRUE) - mean(control, na.rm=TRUE))^2))
)
}
df %>% prmse(estimand = (1/6), treatment =  a_treatment, control = a_control)
df %>% prmse(., estimand = (1/6), treatment =  a_treatment, control = a_control)
df %>% prmse(estimand = .25, treatment =  a_treatment, control = a_control)
prmse(estimand = .25, treatment =  df$a_treatment, control = df$a_control)
df %>% prmse(estimand = .25, treatment =  df$a_treatment, control = df$a_control)
df %>% prmse(data = ., estimand = .25, treatment =  df$a_treatment, control = df$a_control)
df %>% prmse(estimand = .25, treatment =  df$a_treatment, control = df$a_control)
prmse <- function(data, estimand, treatment, control) {
sqrt(
(var(treatment, na.rm=TRUE) + var(control, na.rm=TRUE))
+ (estimand - ((mean(treatment, na.rm=TRUE) - mean(control, na.rm=TRUE))^2))
)
}
df %>% prmse(estimand = .25, treatment =  df$a_treatment, control = df$a_control)
prmse_a <- df %>% prmse(estimand = .25, a_treatment, a_control)
prmse_a <- df %>% prmse(estimand = .25, a_treatment, a_control)
df %>% prmse(estimand = .25, treatment =  a_treatment, control = df$a_control)
df %>% prmse(data = ., estimand = .25, treatment =  a_treatment, control = df$a_control)
prmse_a <-  prmse(estimand = .25, df$a_treatment, df$a_control)
prmse <- function(estimand, treatment, control) {
sqrt(
(var(treatment, na.rm=TRUE) + var(control, na.rm=TRUE))
+ (estimand - ((mean(treatment, na.rm=TRUE) - mean(control, na.rm=TRUE))^2))
)
}
prmse_a <-  prmse(estimand = .25, df$a_treatment, df$a_control)
prmse_a <- function(treatment, control) {
sqrt(
(var(treatment, na.rm=TRUE) + var(control, na.rm=TRUE))
+ ((.25)) - ((mean(treatment, na.rm=TRUE) - mean(control, na.rm=TRUE))^2))
)
}
prmse_a <- function(treatment, control) {
sqrt(
(var(treatment, na.rm=TRUE) + var(control, na.rm=TRUE))
+ ((.25) - ((mean(treatment, na.rm=TRUE) - mean(control, na.rm=TRUE))^2))
)
}
df %>% prmse_a(a_treatment, a_control)
df %>% prmse_a(treatment= a_treatment, control = a_control)
library(tidyverse)
df %>% prmse_a(treatment= a_treatment, control = a_control)
prmse_a <-  prmse(estimand = .25, df$a_treatment, df$a_control)
#don't know what fucked up the function but have to use base r
df <- df %>% filter(attentive_imc = "attentive")
prmse_a <-  prmse(estimand = .25, df$a_treatment, df$a_control)
#don't know what fucked up the function but have to use base r
df <- df %>% filter(attentive_imc == "attentive")
prmse_b <- prmse(estimand = (1/6), df$b_treatment, df$b_control)
prmse_b_placebo <- prmse(estimand = (1/6), df$b_treatment, df$b_placebo)
prmse_b <- prmse(estimand = .2, df$b_treatment, df$b_control)
prmse_b_placebo <- prmse(estimand = (1/6), df$b_treatment, df$b_placebo)
library(qualtRics)
library(tidyverse)
library(lubridate)
#browse all surveys
surveys <- all_surveys()
surveys
#we want data from the 5th one in the list (for now it generated test data)
df <- fetch_survey(surveys$id[5], convert = FALSE, force_request = TRUE)
View(df)
#lets clean and mutate the variables
df <- df %>%
select(ResponseID:EndDate, Finished, age:audit, a_control, a_treatment,
b_control, b_placebo, b_treatment, c_control, c_treatment, d_control,
d_treatment, e_control, e_placebo, e_treatment, fmc_a, fmc_b, fmc_e,
placebo_1_direct:sponsor,
lat = LocationLatitude, lng = LocationLongitude, LocationAccuracy) %>%
mutate(imc_1 = ifelse(is.na(IMC_1_1) & is.na(IMC_1_2) & is.na(IMC_1_4) & is.na(IMC_1_5) & is.na(IMC_1_6),
"pass", "fail"),
imc_2_1 = ifelse(imc_2_1 == "说不上同意或反对", "pass", "fail"),
imc_2_2 = ifelse(imc_2_2 == "强烈同意", "pass", "fail"),
attentive_imc = ifelse(imc_1 == "pass" & imc_2_1 == "pass" & imc_2_2 == "pass",
"attentive", "inattentive"),
audit = ifelse(is.na(audit), "control", "received"),
fmc_a = ifelse(fmc_a == "在我们国家，空气污染是一个重要的问题。", "pass", "fail"),
fmc_b = ifelse(fmc_b == "政府就像是家长，应该告诉人民应该做什么。", "pass", "fail"),
fmc_e = ifelse(fmc_e == "政府为所有人提供优质的公共服务。", "pass", "fail"),
c_direct_dk = ifelse(c_direct == "不想回答", 1, 0), #for priming checks
d_direct_dk = ifelse(d_direct == "不想回答", 1, 0), #and filter drop DK
e_direct_dk = ifelse(e_direct == "不想回答", 1, 0), #in main analysis
c_direct = ifelse(c_direct == "同意", 1, 0),
d_direct = ifelse(d_direct == "同意", 1, 0),
e_direct = ifelse(e_direct == "同意", 1, 0),
placebo_direct = ifelse(placebo_1_direct == "同意" | placebo_2_direct == "同意", 1, 0),
time_spent = time_length(interval(as_datetime(StartDate), as_datetime(EndDate))) #in seconds!
)  %>%
select(-c(IMC_1_1:IMC_1_6, info, imc_2_3:imc_2_7, placebo_1_direct:placebo_2_direct,
StartDate, EndDate))
#lets remove"项" from the treatment, control and placebo groups
keep_digit <- function(x) gsub("[^0-9]", "", x)
vars <- c("a_control", "a_treatment", "b_control", "b_placebo", "b_treatment",
"c_control", "c_treatment", "d_control","d_treatment",
"e_control", "e_placebo", "e_treatment")
df <-  df %>% mutate_at(vars, keep_digit)
write_csv(df, "data/survey-data.csv")
library(tidyverse)
library(rio)
library(mapview)
library(sf)
rm(list=ls())
library(ggplot2); theme_set(theme_classic())
#pass imc_1 (click next)
df %>% group_by(imc_1) %>% summarise(N=n())
#pass imc_2_1 (chose middle option)
df %>% group_by(imc_2_1) %>% summarise(N=n())
#get data
df <- import("data/survey-data.csv")
#pass imc_1 (click next)
df %>% group_by(imc_1) %>% summarise(N=n())
#pass imc_2_1 (chose middle option)
df %>% group_by(imc_2_1) %>% summarise(N=n())
#pass imc_2_2 (two greater than one)
df %>% group_by(imc_2_2) %>% summarise(N=n())
#how many are attentive in our sample?
df %>% group_by(attentive_imc) %>% summarise(N=n())
df %>%
ggplot(aes(x=time_spent)) +
geom_density()
df %>%
ggplot(aes(x=time_spent, fill = attentive_imc)) +
geom_density()
unique(df$IPAddress, na.rm=TRUE)
table(unique(df$IPAddress, na.rm=TRUE))

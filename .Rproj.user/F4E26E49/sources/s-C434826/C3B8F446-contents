# trying out the qaultRics pgk

#install.packages("qualtRics")
library(qualtRics)
library(tidyverse)

#register credentials for the API
#skicka mail så att Frida Salin kan hon ge API access för ditt konto ;) Eller kör på mina nedan.

#qualtrics_api_credentials(
#  api_key = "G74s88l1w3mW0gCb1iQ5Ir6GFealInKUioYLVl6x",
#  base_url = "https://samgu.eu.qualtrics.com", 
#  install = TRUE, 
#  overwrite = TRUE
#)

#browse all surveys
surveys <- all_surveys()
surveys

# lets get the data - there is none
survey_df <- fetch_survey(surveys[5,1])
head(survey_df)

# lets get the survey questions
questions <- survey_questions(surveys$id[5])
questions

# need to clean away html-junk...
#lets write a cleaner function
clean_html <- function(x) {
  return(gsub("<.*?>", "", x))
}

#seem to work
questions <- questions %>% 
  mutate(Wording = clean_html(question), 
         Tag = clean_html(qnames)) %>%
  select(Tag, Wording)

# save as csv to be called from pap2.Rmd
write_csv(questions, "data/question_wording.csv")

#would be nice to automatically get answer options in there, as well as info on randomization

# lets see whats in the metadata...
meta <- metadata(surveys[5,1])



